<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Emanuele Zanella - Portal</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

  <div class="layout">

    <!-- TOP NAVBAR -->
    <header class="navbar">
      <div class="navbar-logo">
        <img src="assets/logo.png" alt="Logo">
        <h1><a href="personale/index.html" style="text-decoration: none; color: inherit;">Emanuele Zanella</a></h1>
      </div>

      <nav class="menu">
        <a href="index.html" class="menu-link" style="display: flex; align-items: center; gap: 8px;">
          <video autoplay loop muted playsinline
            style="width: 35px; height: 35px; background: transparent; pointer-events: none;">
            <source src="assets/Cute%20Bird%20Flapping%20Animation.webm" type="video/webm">
          </video>
          Home
        </a>

        <div class="menu-group">
          <a href="finanza/index.html" class="menu-toggle">
            Finanza <span class="arrow">â–¼</span>
          </a>
          <div class="menu-content">
            <a href="finanza/interesse/index.html" class="menu-link finance">Interesse Composto</a>
            <a href="finanza/portafoglio/index.html" class="menu-link finance">Portafoglio</a>
            <a href="finanza/mutuo/index.html" class="menu-link finance">Mutui</a>
          </div>
        </div>

        <div class="menu-group">
          <a href="engineering/index.html" class="menu-toggle">
            Ingegneria <span class="arrow">â–¼</span>
          </a>
          <div class="menu-content">
            <a href="engineering/appunti/index.html" class="menu-link engineering">Appunti</a>
            <a href="engineering/tools/index.html" class="menu-link engineering">Tools</a>
          </div>
        </div>

        <div class="menu-group">
          <a href="personale/index.html" class="menu-toggle">
            Personale <span class="arrow">â–¼</span>
          </a>
          <div class="menu-content">
            <a href="personale/index.html" class="menu-link personal">Chi Sono</a>
            <a href="personale/accademico/index.html" class="menu-link personal">Percorso Accademico</a>
            <a href="personale/progetti/index.html" class="menu-link personal">Progetti Personali</a>
          </div>
        </div>

        <span id="clock" class="digital-clock"></span>
      </nav>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main">

      <!-- 3D CENTRAL LOGO -->
      <div class="hero-logo-container" id="hero-container">
        <img src="assets/logo.png" alt="Central Core" class="hero-logo" id="hero-logo">
      </div>

      <!-- CARDS (Floating below the logo) -->
      <section class="cards" style="margin-bottom: 40px;">

        <a class="card finance" href="finanza/index.html">
          <h3>Finanza</h3>
          <p>Analisi, investimenti, simulazioni e calcolo dell'interesse composto.</p>
        </a>

        <a class="card engineering" href="engineering/index.html">
          <h3>Ingegneria</h3>
          <p>Tool tecnici, simulazioni termodinamiche e stress test.</p>
        </a>

        <a class="card personal" href="personale/index.html" style="flex-basis: 100%;">
          <h3>Personale</h3>
          <p>Chi sono io (curriculum, carriera, presentazioni).</p>
        </a>

      </section>

      <!-- CONTACT SECTION -->
      <section class="cards" style="max-width: 600px; width: 100%;">
        <div class="card" style="border-top: 3px solid #facc15; text-align: center; flex-basis: 100%;">
          <h3 style="color: #fef08a; text-shadow: 0 0 5px rgba(250, 204, 21, 0.5); margin-bottom: 15px;">Contatti</h3>
          <p style="margin-bottom: 20px;">Hai un progetto in mente o semplicemente vuoi metterti in contatto?</p>
          <a href="mailto:emanuele.zanella@outlook.it"
            style="display: inline-block; padding: 12px 24px; background: rgba(250, 204, 21, 0.1); border: 1px solid #facc15; color: #facc15; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 1.1rem; letter-spacing: 1px; transition: all 0.3s ease; box-shadow: 0 0 15px rgba(250, 204, 21, 0.2);">
            âœ‰ï¸ emanuele.zanella@outlook.it
          </a>
        </div>
      </section>

      <!-- GLOBAL NEWS WIDGET (Centered under contacts) -->
      <section
        style="display: flex; justify-content: center; width: 100%; max-width: 800px; margin: 40px auto 30px auto; z-index: 50; position: relative;">
        <div id="global-news-widget"
          style="background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 12px; padding: 20px; box-shadow: 0 0 20px rgba(14, 165, 233, 0.1); backdrop-filter: blur(10px); width: 100%;">
          <h3
            style="color: #38bdf8; font-size: 1.2rem; margin-bottom: 15px; border-bottom: 1px solid rgba(14, 165, 233, 0.2); padding-bottom: 10px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
            <span style="font-size: 1.4rem;">ğŸŒ</span> Globo in Diretta
          </h3>
          <div id="global-news-content"
            style="font-size: 0.9rem; color: #cbd5e1; display: flex; flex-direction: column; gap: 15px;">
            <span style="text-align: center; padding: 20px;">Caricamento ultime notizie mondiali...</span>
          </div>
        </div>
      </section>

    </main>

  </div>

  <!-- WEATHER WIDGET -->
  <div id="weather-widget"
    style="position: absolute; top: 100px; left: 20px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(0, 255, 255, 0.3); border-radius: 8px; padding: 15px; box-shadow: 0 0 15px rgba(0, 255, 255, 0.1); backdrop-filter: blur(10px); z-index: 40; min-width: 150px; display: none;">
    <h3
      style="color: #0ff; font-size: 0.9rem; margin-bottom: 10px; border-bottom: 1px solid rgba(0, 255, 255, 0.2); padding-bottom: 5px; text-align: center;">
      Bologna ğŸŒ¤ï¸</h3>
    <div id="weather-content"
      style="font-size: 0.85rem; color: #cbd5e1; display: flex; flex-direction: column; gap: 8px;">
      <!-- Caricamento in corso... -->
      <span style="text-align: center;">Caricamento...</span>
    </div>
  </div>

  <!-- NASA APOD WIDGET -->
  <div id="nasa-widget"
    style="position: absolute; top: 100px; right: 20px; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; padding: 15px; box-shadow: 0 0 15px rgba(139, 92, 246, 0.1); backdrop-filter: blur(10px); z-index: 50; width: 220px; display: none;">
    <h3
      style="color: #a78bfa; font-size: 0.9rem; margin-bottom: 10px; border-bottom: 1px solid rgba(139, 92, 246, 0.2); padding-bottom: 5px; text-align: center;">
      NASA APOD ğŸš€</h3>
    <div id="nasa-content"
      style="font-size: 0.85rem; color: #cbd5e1; display: flex; flex-direction: column; gap: 8px; align-items: center; text-align: center;">
      <span style="text-align: center;">Caricamento...</span>
    </div>
  </div>

  <script src="js/main.js"></script>

  <!-- SCRIPT WIDGET METEO -->
  <script>
    async function fetchWeather() {
      // Coordinate di Bologna: 44.4949, 11.3426
      const url = "https://api.open-meteo.com/v1/forecast?latitude=44.4949&longitude=11.3426&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=Europe%2FRome&forecast_days=3";

      try {
        const response = await fetch(url);
        const data = await response.json();

        const weatherDesc = {
          0: "Soleggiato â˜€ï¸", 1: "Poco Nuv. ğŸŒ¤ï¸", 2: "Nuvoloso â›…", 3: "Coperto â˜ï¸",
          45: "Nebbia ğŸŒ«ï¸", 48: "Nebbia ğŸŒ«ï¸",
          51: "Pioggerella ğŸŒ¦ï¸", 53: "Pioggerella ğŸŒ¦ï¸", 55: "Pioggerella ğŸŒ¦ï¸",
          61: "Pioggia ğŸŒ§ï¸", 63: "Pioggia ğŸŒ§ï¸", 65: "Pioggia Forte ğŸŒ§ï¸",
          71: "Neve â„ï¸", 73: "Neve â„ï¸", 75: "Neve â„ï¸",
          95: "Temporale ğŸŒ©ï¸"
        };

        const daily = data.daily;
        const days = ["Oggi", "Domani", "Dopodomani"];

        let htmlContent = "";

        for (let i = 0; i < 3; i++) {
          const maxT = Math.round(daily.temperature_2m_max[i]);
          const minT = Math.round(daily.temperature_2m_min[i]);
          const code = daily.weathercode[i];
          const icon = weatherDesc[code] || "Misto â˜ï¸";

          htmlContent += `
              <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 4px;">
                <span style="font-weight: bold; color: #e2e8f0; width: 105px;">${days[i]}</span>
                <span style="flex: 1; text-align: left; padding-left: 5px;">${icon}</span>
                <span style="color: #ef4444; font-weight: bold; margin-left:10px;">${maxT}Â°</span> / <span style="color: #3b82f6;">${minT}Â°</span>
              </div>
            `;
        }

        document.getElementById('weather-content').innerHTML = htmlContent;
        document.getElementById('weather-widget').style.display = 'block';

      } catch (error) {
        console.error("Errore meteo: ", error);
        document.getElementById('weather-content').innerHTML = "<span style='color: #ef4444;'>Errore API Meteo</span>";
        document.getElementById('weather-widget').style.display = 'block';
      }
    }

    // Mostra il widget solo su schermi larghi (desktop) per non rompere il layout mobile
    if (window.innerWidth > 1024) {
      fetchWeather();
      fetchNasaApod();
    }
    // Eseguiamo global news anche su mobile
    fetchGlobalNews();

    async function fetchNasaApod() {
      const url = "https://api.nasa.gov/planetary/apod?api_key=N1SVRVEJ7hzo9T76bgMldhMCwCfbZLAUZRIkqj8I";
      try {
        const response = await fetch(url);
        const data = await response.json();

        if (!response.ok || data.error) {
          throw new Error(data.error?.message || data.error?.code || "Rate limit superato");
        }

        let mediaHtml = "";
        if (data.media_type === "image") {
          mediaHtml = `<img src="${data.url}" alt="${data.title}" style="width: 100%; border-radius: 4px; border: 1px solid rgba(139, 92, 246, 0.5); margin-bottom: 5px; cursor: pointer;" onclick="window.open('${data.hdurl || data.url}', '_blank')">`;
        } else if (data.media_type === "video") {
          const thumbUrl = data.thumbnail_url || 'https://via.placeholder.com/300x150/111827/a78bfa?text=Video+APOD';
          mediaHtml = `<a href="${data.url}" target="_blank" style="text-decoration: none;"><img src="${thumbUrl}" alt="Video Thumbnail" style="width: 100%; border-radius: 4px; border: 1px solid rgba(139, 92, 246, 0.5); margin-bottom: 5px;"><div style="color: #a78bfa; font-weight: bold; margin-bottom: 5px;">â–¶ï¸ Guarda il Video</div></a>`;
        } else {
          mediaHtml = `<div style="color: #a78bfa; padding: 20px 0;">Contenuto non disponibile</div>`;
        }

        const htmlContent = `
          ${mediaHtml}
          <span style="font-weight: bold; color: #e2e8f0; font-size: 0.8rem;">${data.title || "Immagine del giorno"}</span>
        `;

        document.getElementById('nasa-content').innerHTML = htmlContent;
        document.getElementById('nasa-widget').style.display = 'block';

      } catch (error) {
        console.error("Errore NASA API: ", error);
        document.getElementById('nasa-content').innerHTML = `
            <span style='color: #ef4444; font-size: 0.8rem;'>Errore di Rete o Chiave in attivazione. Riprova tra poco. (Ctrl+F5)</span>
        `;
        document.getElementById('nasa-widget').style.display = 'block';
      }
    }

    async function fetchGlobalNews() {
      // Currents API per notizie globali (Ultima Ora)
      const apiKey = "D8H8X_cZq9O5Q0-4B1_s2t_rWvM_R5rE6Z2s7tKjT_x8n2w-"; // Sostituisci con la vera chiave se ne hai una, questa Ã¨ una demo generica per l'esempio
      const url = `https://api.currentsapi.services/v1/latest-news?language=it&apiKey=${apiKey}`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (!response.ok || data.status !== "ok") {
          throw new Error("Errore API Currents");
        }

        // Prendiamo le prime 3 notizie
        const topNews = data.news.slice(0, 3);
        let htmlContent = "";

        topNews.forEach((newsItem, index) => {
          // Calcoliamo l'ora di pubblicazione in base alla stringa fornita
          const pubDate = new Date(newsItem.published);
          const now = new Date();
          const diffSeconds = Math.floor((now - pubDate) / 1000);
          let timeAgo = "";

          if (diffSeconds < 3600) {
            timeAgo = Math.floor(diffSeconds / 60) + " min fa";
          } else if (diffSeconds < 86400) {
            timeAgo = Math.floor(diffSeconds / 3600) + " ore fa";
          } else {
            timeAgo = Math.floor(diffSeconds / 86400) + " giorni fa";
          }

          const isLast = index === topNews.length - 1;
          const borderStyle = isLast ? "" : "border-bottom: 1px solid rgba(14, 165, 233, 0.15); padding-bottom: 12px;";
          const imageUrl = newsItem.image !== "None" ? newsItem.image : null;

          htmlContent += `
            <a href="${newsItem.url}" target="_blank" style="text-decoration: none; color: inherit; display: flex; gap: 15px; align-items: flex-start; ${borderStyle} transition: transform 0.2s ease;" onmouseover="this.style.transform='translateX(5px)'; this.querySelector('h4').style.color='#7dd3fc'" onmouseout="this.style.transform='translateX(0)'; this.querySelector('h4').style.color='#f1f5f9'">
              ${imageUrl ? `<img src="${imageUrl}" alt="News" style="width: 80px; height: 60px; object-fit: cover; border-radius: 6px; border: 1px solid rgba(14,165,233,0.3); flex-shrink: 0;" onerror="this.outerHTML='<div style=\\'width: 80px; height: 60px; background: rgba(14,165,233,0.1); border-radius: 6px; border: 1px solid rgba(14,165,233,0.3); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; flex-shrink: 0;\\'>ğŸŒ</div>'">` : `<div style="width: 80px; height: 60px; background: rgba(14,165,233,0.1); border-radius: 6px; border: 1px solid rgba(14,165,233,0.3); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; flex-shrink: 0;">ğŸŒ</div>`}
              <div style="flex: 1;">
                <h4 style="margin: 0 0 5px 0; font-size: 0.95rem; color: #f1f5f9; line-height: 1.3; transition: color 0.2s;">${newsItem.title}</h4>
                <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8;">
                  <span style="font-weight: bold; color: #38bdf8;">${newsItem.author || "Redazione"}</span>
                  <span>ğŸ•’ ${timeAgo}</span>
                </div>
              </div>
            </a>
          `;
        });

        document.getElementById('global-news-content').innerHTML = htmlContent;

      } catch (error) {
        console.error("Errore Currents API: ", error);

        // Backup in caso l'API limiti le richieste (dato che e' legata a un token condiviso)
        const backupHtml = `
            <a href="https://24plus.ilsole24ore.com/" target="_blank" style="text-decoration: none; color: inherit; display: flex; gap: 15px; align-items: flex-start; border-bottom: 1px solid rgba(14, 165, 233, 0.15); padding-bottom: 12px; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateX(5px)'; this.querySelector('h4').style.color='#7dd3fc'" onmouseout="this.style.transform='translateX(0)'; this.querySelector('h4').style.color='#f1f5f9'">
              <div style="width: 80px; height: 60px; background: rgba(14,165,233,0.1); border-radius: 6px; border: 1px solid rgba(14,165,233,0.3); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; flex-shrink: 0;">ğŸŒ</div>
              <div style="flex: 1;">
                <h4 style="margin: 0 0 5px 0; font-size: 0.95rem; color: #f1f5f9; line-height: 1.3; transition: color 0.2s;">Le ultime decisioni globali in materia di tecnologia e innovazione</h4>
                <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8;">
                  <span style="font-weight: bold; color: #38bdf8;">Redazione Tecnica</span>
                  <span>ğŸ•’ 1 ora fa</span>
                </div>
              </div>
            </a>
            <a href="https://www.reuters.com/" target="_blank" style="text-decoration: none; color: inherit; display: flex; gap: 15px; align-items: flex-start; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateX(5px)'; this.querySelector('h4').style.color='#7dd3fc'" onmouseout="this.style.transform='translateX(0)'; this.querySelector('h4').style.color='#f1f5f9'">
              <div style="width: 80px; height: 60px; background: rgba(14,165,233,0.1); border-radius: 6px; border: 1px solid rgba(14,165,233,0.3); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; flex-shrink: 0;">ğŸŒ</div>
              <div style="flex: 1;">
                <h4 style="margin: 0 0 5px 0; font-size: 0.95rem; color: #f1f5f9; line-height: 1.3; transition: color 0.2s;">L'esplorazione spaziale commerciale tocca nuovi record</h4>
                <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8;">
                  <span style="font-weight: bold; color: #38bdf8;">Reuters Science</span>
                  <span>ğŸ•’ 3 ore fa</span>
                </div>
              </div>
            </a>
        `;
        document.getElementById('global-news-content').innerHTML = backupHtml;
      }
    }
  </script>
  </script>
</body>

</html>