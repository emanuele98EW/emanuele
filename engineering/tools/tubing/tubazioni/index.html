<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Tubazioni ‚Äì Cervello Online</title>
  <link rel="stylesheet" href="../../../css/style.css">
</head>

<body>

<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">

    <div class="sidebar-logo">
      <img src="../../../assets/logo.png" alt="Cervello Online">
    </div>

    <nav class="menu">

      <a href="../../../index.html" class="menu-link">
        <span class="icon">üè†</span>
        <span class="text">Home</span>
      </a>

      <a href="../../../finanza/index.html" class="menu-link">
        <span class="icon">üìä</span>
        <span class="text">Finanza</span>
      </a>

      <div class="menu-group open">

        <button class="menu-toggle" onclick="toggleMenu(this)">
          <span class="icon">‚öôÔ∏è</span>
          <span class="text">Ingegneria</span>
          <span class="arrow">‚ñ∂</span>
        </button>

        <div class="menu-content">

          <div class="menu-group open">

            <button class="menu-toggle" onclick="toggleMenu(this)">
              <span class="icon">üîß</span>
              <span class="text">Tool ingegneristici</span>
              <span class="arrow">‚ñ∂</span>
            </button>

            <div class="menu-content">

              <a href="../energy/index.html" class="menu-link">
                <span class="icon">üî•</span>
                <span class="text">Sistemi energetici</span>
              </a>

              <a href="../index.html" class="menu-link">
                <span class="icon">üß™</span>
                <span class="text">Tubing</span>
              </a>

              <a href="index.html" class="menu-link active">
                <span class="icon">üìê</span>
                <span class="text">Tubazioni</span>
              </a>

              <a href="../stress/index.html" class="menu-link">
                <span class="icon">üìä</span>
                <span class="text">Stress analysis</span>
              </a>

            </div>
          </div>

        </div>
      </div>

    </nav>
  </aside>

  <!-- MAIN -->
  <main class="main">

    <header class="topbar">
      <div class="topbar-left">
        <img src="../../../assets/logo.png" class="topbar-logo" alt="logo">
        <h1>Tubazioni</h1>
        <span id="clock" class="digital-clock"></span>
      </div>
    </header>

    <section class="content">

      <h2>üìê Dati dimensionali tubazioni</h2>
      <p>
        Seleziona <strong>DN</strong> e <strong>Schedule</strong>.
        I valori sono calcolati secondo ASME B36.10 / B36.19.
      </p>

      <div class="tool-box">

        <div class="tool-row">
          <label>DN</label>
          <select id="dnSelect">
            <option value="">-- Seleziona DN --</option>
          </select>

          <label>Schedule</label>
          <select id="schSelect">
            <option value="">-- Seleziona Schedule --</option>
          </select>
        </div>

        <div class="pipe-result">

          <div class="pipe-diagram">
            <canvas id="pipeCanvas" width="400" height="260"></canvas>
          </div>

          <div class="pipe-data">
            <p><strong>Diametro esterno (OD):</strong> <span id="od">‚Äì</span></p>
            <p><strong>Diametro interno (ID):</strong> <span id="id">‚Äì</span></p>
            <p><strong>Spessore:</strong> <span id="thk">‚Äì</span></p>
            <p><strong>Peso:</strong> <span id="kgm">‚Äì</span></p>
          </div>

        </div>
      </div>

    </section>

  </main>

</div>

<script>
/* MENU */
function toggleMenu(button) {
  button.parentElement.classList.toggle("open");
}

/* CLOCK */
function updateClock() {
  const n = new Date();
  document.getElementById("clock").textContent =
    n.toLocaleTimeString("it-IT");
}
setInterval(updateClock, 1000);
updateClock();

/* DATI TUBI (estratto ‚Äì puoi estenderli) */
const pipeData = {
  "DN 25": {
    OD: 33.4,
    schedules: {
      "SCH 40": { t: 3.38, kgm: 2.5 },
      "SCH 80": { t: 4.55, kgm: 3.23 }
    }
  },
  "DN 50": {
    OD: 60.3,
    schedules: {
      "SCH 40": { t: 3.91, kgm: 5.44 },
      "SCH 80": { t: 5.54, kgm: 7.48 }
    }
  },
  "DN 100": {
    OD: 114.3,
    schedules: {
      "SCH 40": { t: 6.02, kgm: 16.07 },
      "SCH 80": { t: 8.56, kgm: 22.31 }
    }
  }
};

const dnSelect = document.getElementById("dnSelect");
const schSelect = document.getElementById("schSelect");
const canvas = document.getElementById("pipeCanvas");
const ctx = canvas.getContext("2d");

/* POPOLA DN */
Object.keys(pipeData).forEach(dn => {
  const o = document.createElement("option");
  o.value = dn;
  o.textContent = dn;
  dnSelect.appendChild(o);
});

dnSelect.addEventListener("change", () => {
  schSelect.innerHTML = '<option value="">-- Seleziona Schedule --</option>';
  clearValues();
  if (!dnSelect.value) return;

  Object.keys(pipeData[dnSelect.value].schedules).forEach(sch => {
    const o = document.createElement("option");
    o.value = sch;
    o.textContent = sch;
    schSelect.appendChild(o);
  });
});

schSelect.addEventListener("change", updateValues);

function clearValues() {
  ["od","id","thk","kgm"].forEach(id =>
    document.getElementById(id).textContent = "‚Äì"
  );
  ctx.clearRect(0,0,canvas.width,canvas.height);
}

function updateValues() {
  const dn = dnSelect.value;
  const sch = schSelect.value;
  if (!dn || !sch) return;

  const OD = pipeData[dn].OD;
  const t = pipeData[dn].schedules[sch].t;
  const ID = (OD - 2*t).toFixed(2);
  const kgm = pipeData[dn].schedules[sch].kgm;

  document.getElementById("od").textContent = `${OD} mm`;
  document.getElementById("id").textContent = `${ID} mm`;
  document.getElementById("thk").textContent = `${t} mm`;
  document.getElementById("kgm").textContent = `${kgm} kg/m`;

  drawPipe(OD, ID, t);
}

/* DISEGNO FISSO + VALORI */
function drawPipe(OD, ID, t) {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const cx = canvas.width/2;
  const cy = canvas.height/2;
  const Rext = 80;
  const Rint = 55;

  ctx.fillStyle = "rgba(76,175,80,0.12)";
  ctx.beginPath();
  ctx.arc(cx,cy,Rext,0,Math.PI*2);
  ctx.arc(cx,cy,Rint,0,Math.PI*2,true);
  ctx.fill();

  ctx.strokeStyle="#333";
  ctx.lineWidth=2;
  ctx.beginPath(); ctx.arc(cx,cy,Rext,0,Math.PI*2); ctx.stroke();
  ctx.beginPath(); ctx.arc(cx,cy,Rint,0,Math.PI*2); ctx.stroke();

  ctx.font="bold 14px Arial";
  ctx.fillStyle="#333";
  ctx.textAlign="center";
  ctx.fillText(`OD = ${OD} mm`, cx, cy-Rext-15);
  ctx.fillText(`ID = ${ID} mm`, cx, cy+Rext+25);

  ctx.textAlign="left";
  ctx.fillStyle="#ff6b6b";
  ctx.fillText(`t = ${t} mm`, cx+Rext+20, cy);

  ctx.beginPath();
  ctx.moveTo(cx+Rext+10, cy-Rext);
  ctx.lineTo(cx+Rext+10, cy-Rint);
  ctx.strokeStyle="#ff6b6b";
  ctx.stroke();
}
</script>

</body>
</html>
